#f () {
#    errcode=$? # save the exit code as the first thing done in the trap function
#    echo "error $errorcode" >> /tmp/bserr
#    echo "the command executing at the time of the error was" >> /tmp/bserr
#    echo "$BASH_COMMAND" >> /tmp/bserr
#    echo "on line ${BASH_LINENO[0]}" >> /tmp/bserr
#    # do some error handling, cleanup, logging, notification
#    # $BASH_COMMAND contains the command that was being executed at the time of the trap
#    # ${BASH_LINENO[0]} contains the line number in the script of that command
#    # exit the script or return to try again, etc.
#    # exit $errcode  # or use some other value or do return instead
#}
#
#trap f ERR

# SHELL PROMPT
function parse_git_dirty {
  [[ $(git status 2> /dev/null | tail -n1) != "nothing to commit, working directory clean" ]] && echo "*"
}
function parse_git_branch {
  git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/\1/"
}
function git_prompt {
  git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/[\1$(parse_git_dirty)$(parse_git_push)]/"
}
function parse_git_push {
  [[ $(git log origin/$(parse_git_branch)..$(parse_git_branch) 2> /dev/null) != "" ]] && echo "+"
}

export PS1='\[\033[01;32m\]\u@\h\[\033[01;34m\] \w\[\033[31m\] $(git_prompt)\[\033[01;34m\]
$\[\033[00m\] '

#Append history
HISTCONTROL=ignoredups:ignorespace

# append to the history file, don't overwrite it
shopt -s histappend

##Vi input mode
#set -o vi

# Important Paths
export JAVA_HOME=/usr/lib/jvm/java-1.7.0-openjdk-amd64/
export MAGIC2=$HOME/magic2

export ROBOT_CONFIG=$HOME/magic2/config/robot.config
export VX_SHADER_PATH=$HOME/magic2/src/vx/shaders/
export VX_FONT_PATH=$HOME/magic2/src/vx/fonts/
export WEBVX_HTML_PATH=$HOME/magic2/src/jsvx/webvx_html
export GIT_EDITOR=vim



# all jars
export CLASSPATH=
export CLASSPATH=$CLASSPATH:/usr/local/share/java/lcm.jar
#export CLASSPATH=$CLASSPATH:$HOME/perls/trunk/build/share/java/perls_lcmtypes.jar
#export CLASSPATH=$CLASSPATH:$HOME/ngv/java/ngv.jar
export CLASSPATH=$CLASSPATH:$HOME/april/java/april.jar
#export CLASSPATH=$CLASSPATH:$HOME/dngv/java/dngv.jar
export CLASSPATH=$CLASSPATH:$HOME/magic2/java/magic2.jar

#export CLASSPATH=$CLASSPATH:/usr/share/java/gluegen-rt.jar
#export CLASSPATH=$CLASSPATH:/usr/share/java/jogl.jar
#export CLASSPATH=$CLASSPATH:$HOME/worldwind/worldwind.jar
#export CLASSPATH=$CLASSPATH:$HOME/worldwind/worldwindx.jar

export CLASSPATH=$CLASSPATH:.

# Java load library
export LD_LIBRARY_PATH=/usr/lib
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/april/lib
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/dngv/lib

# path
export PATH=$PATH:$APRILHOME/bin
export PATH=$PATH:$HOME/Utilities/bin
export PATH=$PATH:/opt/arm/bin

# ALIASES
alias ll='ls -l'
alias lla='ls -al'
alias md=mkdir
alias rd=rmdir
alias clr=clear
alias svnst='svn st | grep -v "^?"'
alias java='java -server -ea'
alias java-prof='java -client -agentlib:hprof=cpu=samples,depth=8,interval=1,thread=y'
alias java-prof-view='java -jar $HOME/Utilities/java/PerfAnal.jar java.hprof.txt'
alias grepPS='clear; grep ''publish\('' * -R; echo ; grep ''subscribe\('' * -R'
alias gitk='gitk --all &'
alias 'cd..'='cd ..'
alias gitup='git remote update'
alias gitst='git status'
alias gd='git diff --color'
alias grep="grep -n --color=auto -I"

alias mc="make clean"
alias mcm="make clean all"
alias aca="ant clean build"

function svndiff () {
  svn diff ${1+"$@"} | colordiff | less -R
}

alias viewer='BASE_STATION_ID=103 java $JOPTS april.viewer.Viewer --config $HOME/magic/config/robot.config'

export FIGNORE=CVS:\~:.o:.svn

date

# Colors
NORMAL=`echo -e '\033[0m'`

BLACK=`echo -e '\033[0;30m'`
RED=`echo -e '\033[0;31m'`
GREEN=`echo -e '\033[0;32m'`
YELLOW=`echo -e '\033[0;33m'`
BLUE=`echo -e '\033[0;34m'`
PURPLE=`echo -e '\033[0;35m'`
CYAN=`echo -e '\033[0;36m'`
GRAY=`echo -e '\033[0;37m'`

BOLDGRAY=`echo -e '\033[1;30m'`
BOLDRED=`echo -e '\033[1;31m'`
BOLDGREEN=`echo -e '\033[1;32m'`
BOLDYELLOW=`echo -e '\033[1;33m'`
BOLDBLUE=`echo -e '\033[1;34m'`
BOLDPURPLE=`echo -e '\033[1;35m'`
BOLDCYAN=`echo -e '\033[1;36m'`
BOLDWHITE=`echo -e '\033[1;37m'`

# make with a touch of highlighting
function makeh {
    # colors moved to top of bashrc

    make "$@" 2>&1 | sed \
        -e "s/^\([ ]*\)\(\[[a-zA-Z0-9\.\_\/-]*\)\(\/bin\/\)\([a-zA-Z0-9\.\_\/-]*\]\)\(.*\)$/$NORMAL\1$PURPLE\2\3\4$NORMAL\5/" \
        -e "s/^\([ ]*\)\(\[[a-zA-Z0-9\.\_\/-]*\)\(\/lib\/\)\([a-zA-Z0-9\.\_\/-]*\]\)\(.*\)$/$NORMAL\1$PURPLE\2\3\4$NORMAL\5/" \
        -e "s/^\([ ]*\)\(\[[a-zA-Z0-9\.\_\/-]*\]\)\(.*\)$/$NORMAL\1$GREEN\2$NORMAL\3/" \
        -e "s/^.*undefined reference to.*$/$PURPLE&$NORMAL/" \
        -e "s/\(^.*\)\( [Ee]rror[: ]\)\(.*$\)/$BLUE\1$RED\2$BOLDGRAY\3$NORMAL/" \
        -e "s/\(^.*\)\([Ww]arning[: ]\)\(.*$\)/$BLUE\1$YELLOW\2$BOLDGRAY\3$NORMAL/" \
        -e "s/^.*: In function .*$/$CYAN&$NORMAL/" \
        -e "s/^\s*\(make\[.*\]:.*directory\s\+\)\(\`.*'\)\(.*\)$/$BLUE\1$BOLDGRAY\2$NORMAL\3/" \
        -e "s/^\(gcc\s.*\)$/$YELLOW\1$NORMAL/" \
        -e "s/^\(g++\s.*\)$/$YELLOW\1$NORMAL/" \
        -e "s/^\(ld\s.*\)$/$PURPLE\1$NORMAL/" \
        -e "s/^\(ar\s.*\)$/$PURPLE\1$NORMAL/" \
        -e "s/^rm -[rf][rf]*.*$/$RED&$NORMAL/"

    return ${PIPESTATUS[0]}
}
alias makhe="makeh"

function javahighlight {
    # colors moved to top of bashrc

    sed \
        -e "s/\([^a-zA-Z][Ee]rror[^a-zA-Z]\)\(.*\)$/$RED\1$BOLDGRAY\2$NORMAL/" \
        -e "s/\([^a-zA-Z][Ww]arning[^a-zA-Z]\)\(.*\)$/$YELLOW\1$BOLDGRAY\2$NORMAL/" \
        -e "s/^\([ ]\+\[javac\] \)\(.*\.java:\)\([0-9]*\)\(.* is not.*\|.* does not.*\|.* expected.*\|.* should be declared.*\|.* cannot find symbol.*\|.* cannot be applied to.*\|.* incompatible types.*\|.* generic array creation.*\|.* missing method body.*\|.* might not have been initialized.*\|.* has private access.*\|.* is already defined.*\|.* is ambiguous.*\|.* non-static.*\|.* unreachable.*\|.* illegal.*\|.* unreported.*\|.* cannot be dereferenced.*\|.* no suitable method.*\|.* not an enclosing class.*\|.* cannot return.*\|.* possible loss of precision.*\|.* array required.*\|.* not a statement.*\|.* foreach not applicable.*\|.* no suitable constructor.*\|.* incomparable types.*\)$/$GREEN\1$YELLOW\2$RED\3$NORMAL\4/" \
        -e "s/^\([ ]\+\[javac\] \)\(Note:\)\(.*\)$/$GREEN\1$BOLDGRAY\2\3$NORMAL/" \
        -e "s/^\([ ]\+\[[a-zA-Z0-9\_\.-]\+\]\)\(.*\)$/$GREEN\1$NORMAL\2/" \
        -e "s/^\(clean[a-zA-Z \_-]*:\)$/$YELLOW\1$NORMAL/" \
        -e "s/^\(generate[a-zA-Z \_-]*:\)$/$BLUE\1$NORMAL/" \
        -e "s/^\(build[a-zA-Z \_-]*:\)$/$CYAN\1$NORMAL/" \
        -e "s/^\([a-zA-Z \_-]\+:\)$/$CYAN\1$NORMAL/"
}

function javach {
    javac "$@" 2>&1 | javahighlight

    return ${PIPESTATUS[0]}
}

function anth {
    ant "$@" 2>&1 | javahighlight

    return ${PIPESTATUS[0]}
}

alias mhja="makeh -j; alert"
